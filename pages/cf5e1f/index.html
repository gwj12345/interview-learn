<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>存储引擎 | 面试问题学习笔记</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/img/favicon.ico">
    <script data-ad-client="ca-pub-7828333725993554" async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <meta name="description" content="把面试笔记浓缩成简短的几句话">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.2d5420de.css" as="style"><link rel="preload" href="/assets/js/app.2c633bc6.js" as="script"><link rel="preload" href="/assets/js/2.db71ae02.js" as="script"><link rel="preload" href="/assets/js/84.5096e6ac.js" as="script"><link rel="prefetch" href="/assets/js/10.86553da6.js"><link rel="prefetch" href="/assets/js/100.7f06510f.js"><link rel="prefetch" href="/assets/js/101.c1bec214.js"><link rel="prefetch" href="/assets/js/102.d99cc81e.js"><link rel="prefetch" href="/assets/js/103.b7d9f57e.js"><link rel="prefetch" href="/assets/js/104.4de12b9b.js"><link rel="prefetch" href="/assets/js/105.8156cedf.js"><link rel="prefetch" href="/assets/js/106.4d1567b3.js"><link rel="prefetch" href="/assets/js/107.61132b9b.js"><link rel="prefetch" href="/assets/js/108.bc24a7e0.js"><link rel="prefetch" href="/assets/js/109.86846adc.js"><link rel="prefetch" href="/assets/js/11.b5b4b62d.js"><link rel="prefetch" href="/assets/js/12.14e4689a.js"><link rel="prefetch" href="/assets/js/13.ddd4a9bd.js"><link rel="prefetch" href="/assets/js/14.b23a729d.js"><link rel="prefetch" href="/assets/js/15.16729394.js"><link rel="prefetch" href="/assets/js/16.5b235d60.js"><link rel="prefetch" href="/assets/js/17.e54f2b9e.js"><link rel="prefetch" href="/assets/js/18.03b36f23.js"><link rel="prefetch" href="/assets/js/19.91fed66c.js"><link rel="prefetch" href="/assets/js/20.d7395c2c.js"><link rel="prefetch" href="/assets/js/21.891ec3a7.js"><link rel="prefetch" href="/assets/js/22.7f468d3b.js"><link rel="prefetch" href="/assets/js/23.62c81dea.js"><link rel="prefetch" href="/assets/js/24.ee584087.js"><link rel="prefetch" href="/assets/js/25.3df648df.js"><link rel="prefetch" href="/assets/js/26.3e5060b5.js"><link rel="prefetch" href="/assets/js/27.a972921f.js"><link rel="prefetch" href="/assets/js/28.21f7fa9b.js"><link rel="prefetch" href="/assets/js/29.234995e6.js"><link rel="prefetch" href="/assets/js/3.ee7569a7.js"><link rel="prefetch" href="/assets/js/30.98ade6fe.js"><link rel="prefetch" href="/assets/js/31.e7f64971.js"><link rel="prefetch" href="/assets/js/32.74b62115.js"><link rel="prefetch" href="/assets/js/33.d5243324.js"><link rel="prefetch" href="/assets/js/34.fbeffdbf.js"><link rel="prefetch" href="/assets/js/35.ac90872f.js"><link rel="prefetch" href="/assets/js/36.fa3a8c51.js"><link rel="prefetch" href="/assets/js/37.b7a67b9e.js"><link rel="prefetch" href="/assets/js/38.fd35cf21.js"><link rel="prefetch" href="/assets/js/39.5d322ed7.js"><link rel="prefetch" href="/assets/js/4.6d0cbcc3.js"><link rel="prefetch" href="/assets/js/40.235c37cd.js"><link rel="prefetch" href="/assets/js/41.e84ebcf0.js"><link rel="prefetch" href="/assets/js/42.383915b1.js"><link rel="prefetch" href="/assets/js/43.d50d20dc.js"><link rel="prefetch" href="/assets/js/44.3fa2cd1f.js"><link rel="prefetch" href="/assets/js/45.5cf94071.js"><link rel="prefetch" href="/assets/js/46.208c47d8.js"><link rel="prefetch" href="/assets/js/47.71225e13.js"><link rel="prefetch" href="/assets/js/48.7f5fc452.js"><link rel="prefetch" href="/assets/js/49.2af4953c.js"><link rel="prefetch" href="/assets/js/5.28b63d60.js"><link rel="prefetch" href="/assets/js/50.2ae1adcb.js"><link rel="prefetch" href="/assets/js/51.e7d1ec20.js"><link rel="prefetch" href="/assets/js/52.bfd54f2d.js"><link rel="prefetch" href="/assets/js/53.1eb92ed3.js"><link rel="prefetch" href="/assets/js/54.9bbd5c13.js"><link rel="prefetch" href="/assets/js/55.46495f83.js"><link rel="prefetch" href="/assets/js/56.a55e29af.js"><link rel="prefetch" href="/assets/js/57.6840a974.js"><link rel="prefetch" href="/assets/js/58.3b04d18f.js"><link rel="prefetch" href="/assets/js/59.b225e664.js"><link rel="prefetch" href="/assets/js/6.e68cd545.js"><link rel="prefetch" href="/assets/js/60.33e69bd1.js"><link rel="prefetch" href="/assets/js/61.9e5dd5ef.js"><link rel="prefetch" href="/assets/js/62.af44e414.js"><link rel="prefetch" href="/assets/js/63.8946874e.js"><link rel="prefetch" href="/assets/js/64.7c5b55ae.js"><link rel="prefetch" href="/assets/js/65.f21c21a8.js"><link rel="prefetch" href="/assets/js/66.77f742d7.js"><link rel="prefetch" href="/assets/js/67.a62057d0.js"><link rel="prefetch" href="/assets/js/68.c3d03a9d.js"><link rel="prefetch" href="/assets/js/69.c8bbff28.js"><link rel="prefetch" href="/assets/js/7.71e9517c.js"><link rel="prefetch" href="/assets/js/70.a7143f28.js"><link rel="prefetch" href="/assets/js/71.fe96bc9a.js"><link rel="prefetch" href="/assets/js/72.1f574e78.js"><link rel="prefetch" href="/assets/js/73.1daf4fa8.js"><link rel="prefetch" href="/assets/js/74.18166d36.js"><link rel="prefetch" href="/assets/js/75.92418daa.js"><link rel="prefetch" href="/assets/js/76.fd665b22.js"><link rel="prefetch" href="/assets/js/77.3a42c3eb.js"><link rel="prefetch" href="/assets/js/78.77b3b475.js"><link rel="prefetch" href="/assets/js/79.6839354a.js"><link rel="prefetch" href="/assets/js/8.545d3095.js"><link rel="prefetch" href="/assets/js/80.37b2417d.js"><link rel="prefetch" href="/assets/js/81.27e0ee5a.js"><link rel="prefetch" href="/assets/js/82.331a9fac.js"><link rel="prefetch" href="/assets/js/83.7b0c32c7.js"><link rel="prefetch" href="/assets/js/85.f2c3f4b0.js"><link rel="prefetch" href="/assets/js/86.9ce7490c.js"><link rel="prefetch" href="/assets/js/87.a6b6f03e.js"><link rel="prefetch" href="/assets/js/88.ba2f989a.js"><link rel="prefetch" href="/assets/js/89.20aa4750.js"><link rel="prefetch" href="/assets/js/9.f8f0920d.js"><link rel="prefetch" href="/assets/js/90.2afeec89.js"><link rel="prefetch" href="/assets/js/91.15f887f4.js"><link rel="prefetch" href="/assets/js/92.235cdfff.js"><link rel="prefetch" href="/assets/js/93.d7f68794.js"><link rel="prefetch" href="/assets/js/94.2bef2153.js"><link rel="prefetch" href="/assets/js/95.5ef874b6.js"><link rel="prefetch" href="/assets/js/96.6841453d.js"><link rel="prefetch" href="/assets/js/97.494505f7.js"><link rel="prefetch" href="/assets/js/98.fd2bea86.js"><link rel="prefetch" href="/assets/js/99.c65ff6c2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.2d5420de.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/study.png" alt="面试问题学习笔记" class="logo"> <span class="site-name can-hide">面试问题学习笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学科" class="dropdown-title"><a href="/base/" class="link-title">学科</a> <span class="title" style="display:none;">学科</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/5bfa72/" class="nav-link">操作系统</a></li><li class="dropdown-item"><!----> <a href="/pages/6bb966/" class="nav-link">计算机网络</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/front/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/327398/" class="nav-link">JavaScript/HTML</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/backend/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/05f204/" class="nav-link">Go</a></li><li class="dropdown-item"><!----> <a href="/pages/0b69c8/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/pages/9baa5c/" class="nav-link">spring全家桶</a></li><li class="dropdown-item"><!----> <a href="/pages/4ee7f5/" class="nav-link">中间件</a></li><li class="dropdown-item"><!----> <a href="/pages/1aef7c/" class="nav-link">MySQL</a></li><li class="dropdown-item"><!----> <a href="/pages/cbd711/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/pages/9fbb16/" class="nav-link">MongoDB</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他岗位" class="dropdown-title"><a href="/other/" class="link-title">其他岗位</a> <span class="title" style="display:none;">其他岗位</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/7426b1/" class="nav-link">C/C++</a></li><li class="dropdown-item"><!----> <a href="/pages/56e2d2/" class="nav-link">安全相关</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发工具" class="dropdown-title"><a href="/tools/" class="link-title">开发工具</a> <span class="title" style="display:none;">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/6bf004/" class="nav-link">软件相关</a></li><li class="dropdown-item"><!----> <a href="/pages/a5d462/" class="nav-link">系统相关</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试" class="dropdown-title"><a href="/interview/" class="link-title">面试</a> <span class="title" style="display:none;">面试</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/e6c953/" class="nav-link">智力题</a></li><li class="dropdown-item"><!----> <a href="/pages/cfc81f/" class="nav-link">业务问题</a></li></ul></div></div> <a href="https://github.com/gwj12345/interview-learn" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学科" class="dropdown-title"><a href="/base/" class="link-title">学科</a> <span class="title" style="display:none;">学科</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/5bfa72/" class="nav-link">操作系统</a></li><li class="dropdown-item"><!----> <a href="/pages/6bb966/" class="nav-link">计算机网络</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/front/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/327398/" class="nav-link">JavaScript/HTML</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/backend/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/05f204/" class="nav-link">Go</a></li><li class="dropdown-item"><!----> <a href="/pages/0b69c8/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/pages/9baa5c/" class="nav-link">spring全家桶</a></li><li class="dropdown-item"><!----> <a href="/pages/4ee7f5/" class="nav-link">中间件</a></li><li class="dropdown-item"><!----> <a href="/pages/1aef7c/" class="nav-link">MySQL</a></li><li class="dropdown-item"><!----> <a href="/pages/cbd711/" class="nav-link">Redis</a></li><li class="dropdown-item"><!----> <a href="/pages/9fbb16/" class="nav-link">MongoDB</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他岗位" class="dropdown-title"><a href="/other/" class="link-title">其他岗位</a> <span class="title" style="display:none;">其他岗位</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/7426b1/" class="nav-link">C/C++</a></li><li class="dropdown-item"><!----> <a href="/pages/56e2d2/" class="nav-link">安全相关</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发工具" class="dropdown-title"><a href="/tools/" class="link-title">开发工具</a> <span class="title" style="display:none;">开发工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/6bf004/" class="nav-link">软件相关</a></li><li class="dropdown-item"><!----> <a href="/pages/a5d462/" class="nav-link">系统相关</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试" class="dropdown-title"><a href="/interview/" class="link-title">面试</a> <span class="title" style="display:none;">面试</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/e6c953/" class="nav-link">智力题</a></li><li class="dropdown-item"><!----> <a href="/pages/cfc81f/" class="nav-link">业务问题</a></li></ul></div></div> <a href="https://github.com/gwj12345/interview-learn" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Go</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JAVA</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>spring全家桶</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>中间件</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MySQL</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Redis</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>MongoDB</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/9fbb16/" class="sidebar-link">面试问题汇总</a></li><li><a href="/pages/cf5e1f/" aria-current="page" class="active sidebar-link">存储引擎</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/cf5e1f/#存储引擎介绍" class="sidebar-link">存储引擎介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/cf5e1f/#wiredtiger" class="sidebar-link">WiredTiger</a></li><li class="sidebar-sub-header level3"><a href="/pages/cf5e1f/#mmapv1" class="sidebar-link">MMAPv1</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/cf5e1f/#日志相关" class="sidebar-link">日志相关</a></li></ul></li><li><a href="/pages/eb0774/" class="sidebar-link">索引</a></li><li><a href="/pages/e01e5e/" class="sidebar-link">分布式和集群</a></li><li><a href="/pages/200688/" class="sidebar-link">体系和架构</a></li><li><a href="/pages/824f04/" class="sidebar-link">常用命令</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/backend/#后端" data-v-06225672>后端</a></li><li data-v-06225672><a href="/backend/#MongoDB" data-v-06225672>MongoDB</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/gwj12345" target="_blank" title="作者" class="beLink" data-v-06225672>小哈里</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2021-04-06</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">存储引擎<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="存储引擎介绍"><a href="#存储引擎介绍" class="header-anchor">#</a> 存储引擎介绍</h2> <p>MongoDB支持的引擎有：WiredTiger，MMAPv1和In-Memory。</p> <p>从MongoDB 3.2 版本开始，WiredTiger成为MongDB默认的Storage Engine，用于将数据持久化存储到硬盘文件中，WiredTiger提供文档级别（Document-Level）的并发控制，检查点（CheckPoint），数据压缩和本地数据加密（ Native Encryption）等功能。</p> <h3 id="wiredtiger"><a href="#wiredtiger" class="header-anchor">#</a> WiredTiger</h3> <p>所有的write请求都基于“文档级别”的lock，因此多个客户端可以同时更新一个colleciton中的不同文档，这种更细颗粒度的lock，可以支撑更高的读写负载和并发量。因为对于production环境，更多的CPU可以有效提升wireTiger的性能，因为它是的IO是多线程的。</p> <p>WiredTiger的写操作会先写入Cache，并持久化到WAL(Write ahead log)，每60s或log文件达到2GB时会做一次Checkpoint，将当前的数据持久化，产生一个新的快照。Wiredtiger连接初始化时，首先将数据恢复至最新的快照状态，然后根据WAL恢复数据，以保证存储可靠性。</p> <p><img src="https://img.xiaoyou66.com/2021/04/08/0e430a2c46058.png" alt="0102-zyd-MongoDB WiredTiger存储引擎实现原理-1"></p> <p>Wiredtiger的Cache采用Btree的方式组织，每个Btree节点为一个page，root page是btree的根节点，internal page是btree的中间索引节点，leaf page是真正存储数据的叶子节点；btree的数据以page为单位按需从磁盘加载或写入磁盘。</p> <p><img src="https://img.xiaoyou66.com/2021/04/08/fd372ee521b25.png" alt="0102-zyd-MongoDB WiredTiger存储引擎实现原理-2"></p> <p>Wiredtiger采用Copy on write的方式管理修改操作（insert、update、delete），修改操作会先缓存在cache里，持久化时，修改操作不会在原来的leaf page上进行，而是写入新分配的page，每次checkpoint都会产生一个新的root page。</p> <p><img src="https://img.xiaoyou66.com/2021/04/08/94641455dbb14.png" alt="0102-zyd-MongoDB WiredTiger存储引擎实现原理-3"></p> <p>Wiredtiger数据库存储结构如下</p> <p><img src="https://img.xiaoyou66.com/2021/04/08/c9c911b82086a.png" alt="image-20210408162616700"></p> <ul><li>WiredTiger.basecfg存储基本配置信息</li> <li>WiredTiger.lock用于防止多个进程连接同一个Wiredtiger数据库</li> <li>table*.wt存储各个tale（数据库中的表）的数据</li> <li>WiredTiger.wt是特殊的table，用于存储所有其他table的元数据信息</li> <li>WiredTiger.turtle存储WiredTiger.wt的元数据信息</li> <li>journal存储Write ahead log</li></ul> <p><img src="https://img.xiaoyou66.com/2021/04/08/3b01a716a24d4.jpg" alt="0102-zyd-MongoDB WiredTiger存储引擎实现原理-4"></p> <p>一次Checkpoint的大致流程如下</p> <p>对所有的table进行一次Checkpoint，每个table的Checkpoint的元数据更新至WiredTiger.wt
对WiredTiger.wt进行Checkpoint，将该table Checkpoint的元数据更新至临时文件WiredTiger.turtle.set
将WiredTiger.turtle.set重命名为WiredTiger.turtle
上述过程如中间失败，Wiredtiger在下次连接初始化时，首先将数据恢复至最新的快照状态，然后根据WAL恢复数据，以保证存储可靠性。</p> <p>更详细的参考</p> <p><a href="https://mongoing.com/archives/2540" target="_blank" rel="noopener noreferrer">MongoDB Wiredtiger存储引擎实现原理 | MongoDB中文社区 (mongoing.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="mmapv1"><a href="#mmapv1" class="header-anchor">#</a> MMAPv1</h3> <p>mongodb原生的存储引擎，比较简单，直接使用系统级的内存映射文件机制（memory mapped files）对于insert、read和in-place update（update不导致文档的size变大）性能较高；</p> <p>MMAPV1在lock的并发级别上， <strong>支持到collection级别</strong> ，所以对于同一个collection同时只能有一个write操作执行，这一点相对于wiredTiger而言，在write并发性上就稍弱一些。</p> <p><strong>下面简单说一下这个存储引擎</strong></p> <p>每个Database(DB)由一个.ns文件及若干个数据文件组成，数据文件从0开始编号，依次为mydb.0、mydb.1、mydb.2等，文件大小从64MB起，依次倍增，最大为2GB。</p> <p><img src="https://img.xiaoyou66.com/2021/04/08/591d2ad3eb689.jpg" alt="img"></p> <p>每个DB包含多个namespace，mydb.ns实际上是一个hash表（采用线性探测方式解决冲突），用于快速定位某个namespace的起始位置。</p> <p>每个数据文件被划分成多个extent，每个extent只包含一个namespace的数据，同一个namespace的所有extent之间以双向链表形式组织。</p> <p>每个extent包含多个Record（对应mongodb的document）,同一个extent下的所有record以双向链表形式组织。</p> <p>每个Record对应mongodb里的一个文档，每个Record包含固定长度16bytes的描述信息。</p> <p>参考：</p> <p><a href="https://zhuanlan.zhihu.com/p/32102406" target="_blank" rel="noopener noreferrer">MongoDB 存储引擎 mmapv1 原理解析 - 知乎 (zhihu.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="日志相关"><a href="#日志相关" class="header-anchor">#</a> 日志相关</h2> <p>MongoDB中有4种日志，分别是系统日志、Journal日志、oplog主从日志、慢查询日志等。这些日志记录着MongoDB数据库不同方面的踪迹。下面分别介绍这几种日志。</p> <p><strong>系统日志</strong></p> <p>系统日志在MongoDB数据库中很重要，它记录着MongoDB启动和停止的操作，以及服务器在运行过程中发生的任何异常信息。</p> <p><strong>Journal日志</strong></p> <p>journaling(日记) 日志功能则是 MongoDB 里面非常重要的一个功能 ， 它保证了数据库服务器在意外断电 、 自然灾害等情况下数据的完整性。它通过预写式的redo日志为MongoDB增加了额外的可靠性保障。开启该功能时,MongoDB会在进行写入时建立一条Journal日志,其中包含了此次写入操作具体更改的磁盘地址和字节。因此一旦服务器突然停机，可在启动时对日记进行重放，从而重新执行那些停机前没能够刷新到磁盘的写入操作。</p> <p>MongoDB配置WiredTiger引擎使用内存缓冲区来保存journal记录,WiredTiger根据以下间隔或条件将缓冲的日志记录同步到磁盘。</p> <ol><li>从MongoDB 3.2版本开始每隔50ms将缓冲的journal数据同步到磁盘</li> <li>如果写入操作设置了j:true，则WiredTiger强制同步日志文件</li> <li>由于MongoDB使用的journal文件大小限制为100MB,因此WiredTiger大约每100MB数据创建一个新的日志文件。当WiredTiger创建新的journal文件时，WiredTiger会同步以前journal文件</li></ol> <p>MongoDB达到上面的提交，便会将更新操作写入日志。这意味着MongoDB会批量地提交更改，即每次写入不会立即刷新到磁盘。不过在默认设置下，系统发生崩溃时，不可能丢失超过50ms的写入数据。</p> <p>数据文件默认每60秒刷新到磁盘一次，因此Journal文件只需记录约60s的写入数据。日志系统为此预先分配了若干个空文件，这些文件存放在/data/db/journal目录中，目录名为_j.0、_j.1等 长时间运行MongoDB后，日志目录中会出现类似_j.6217、_j.6218的文件，这些是当前的日志文件，文件中的数值会随着MongoDB运行时间的增长而增大。数据库正常关闭后，日记文件会被清除(因为正常关闭后就不在需要这些文件了).</p> <p>向mongodb中写入数据是先写入内存，然后每隔60s在刷盘，同样写入journal,也是先写入对应的buffer，然后每隔50ms在刷盘到磁盘的journal文件 使用WiredTiger，即使没有journal功能，MongoDB也可以从最后一个检查点(checkpoint,可以想成镜像)恢复;但是，要恢复在上一个检查点之后所做的更改，还是需要使用Journal</p> <p>如发生系统崩溃或使用kill -9命令强制终止数据库的运行，mongod会在启动时重放journal文件，同时会显示出大量的校验信息。</p> <p>需要注意的是如果客户端的写入速度超过了日记的刷新速度，mongod则会限制写入操作，直到日记完成磁盘的写入。这是mongod会限制写入的唯一情况。</p> <p><strong>固定集合(Capped Collection)</strong></p> <p>在讲下面两种日志之前先来认识下capped collection。</p> <p>MongoDB中的普通集合是动态创建的，而且可以自动增长以容纳更多的数据。MongoDB中还有另一种不同类型的集合，叫做固定集合。固定集合需要事先创建好，而且它的大小是固定的。固定集合的行为类型与循环队列一样。如果没有空间了，最老的文档会被删除以释放空间，新插入的文档会占据这块空间。</p> <p>比如我我们创建一个固定集合</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>db.createCollection<span class="token punctuation">(</span><span class="token string">&quot;collectionName&quot;</span>,<span class="token punctuation">{</span><span class="token string">&quot;capped&quot;</span>:true, <span class="token string">&quot;size&quot;</span>:100000, <span class="token string">&quot;max&quot;</span>:100<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>创建了一个大小为100000字节的固定大小集合,文档数量为100.不管先到达哪个限制，之后插入的新文档就会把最老的文档挤出集合：<strong>固定集合的文档数量不能超过文档数量限制，也不能超过大小限制。</strong></p> <p>固定集合创建之后就不能改变,无法将固定集合转换为非固定集合,但是可以将常规集合转换为固定集合。</p> <p>固定集合可以进行一种特殊的排序，称为自然排序(natural sort),自然排序返回结果集中文档的顺序就是文档在磁盘的顺序。自然顺序就是文档的插入顺序，因此自然排序得到的文档是从旧到新排列的。当然也可以按照从新到旧：</p> <p><strong>oplog主从日志</strong></p> <p>Replica Sets复制集用于在多台服务器之间备份数据。MongoDB的复制功能是使用操作日志oplog实现的，操作日志包含了主节点的每一次写操作。oplog是主节点的local数据库中的一个固定集合。备份节点通过查询这个集合就可以知道需要进行复制的操作。</p> <blockquote><p>一个mongod实例中的所有数据库都使用同一个oplog，也就是所有数据库的操作日志(插入，删除，修改)都会记录到oplog中</p></blockquote> <p>每个备份节点都维护着自己的oplog,记录着每一次从主节点复制数据的操作。这样，每个成员都可以作为同步源给其他成员使用。 如图所示，备份节点从当前使用的同步源中获取需要执行的操作，然后在自己的数据集上执行这些操作，最后再将这些操作写入自己的oplog,如果遇到某个操作失败的情况(只有当同步源的数据损坏或者数据与主节点不一致时才可能发生),那么备份节点就会停止从当前的同步源复制数据。</p> <p>oplog中按顺序保存着所有执行过的写操作，replica sets中每个成员都维护者一份自己的oplog，每个成员的oplog都应该跟主节点的oplog完全一致(可能会有一些延迟)</p> <p>如果某个备份节点由于某些原因挂了，但它重新启动后，就会自动从oplog中最后一个操作开始进行同步。由于复制操作的过程是想复制数据在写入oplog,所以备份节点可能会在已经同步过的数据上再次执行复制操作。MongoDB在设计之初就考虑到了这种情况:将oplog中的同一个操作执行多次，与只执行一次的效果是一样的。</p> <p>由于oplog大小是固定的，它只能保持特定数量的操作日志。通常，oplog使用空间的增长速度与系统处理写请求的速率几乎相同：如果主节点上每分钟处理了1KB的写入请求，那么oplog很可能也会在一分钟内写入1KB条操作日志。</p> <p>但是，有一些例外：如果单次请求能够影响到多个文档(比如删除多个文档或者多文档更新),oplog中就会出现多条操作日志。如果单个操作会影响多个文档，那么每个受影响的文档都会对应oplog的一条日志。因此，如果执行db.student.remove()删除了10w个文档，那么oplog中也就会有10w条操作日志，每个日志对应一个被删除的文档。如果执行大量的批量操作，oplog很快就会被填满。</p> <p><strong>慢查询日志</strong></p> <p>MongoDB中使用系统分析器(system profiler)来查找耗时过长的操作。系统分析器记录固定集合system.profile中的操作，并提供大量有关耗时过长的操作信息，但相应的mongod的整体性能也会有所下降。因此我们一般定期打开分析器来获取信息。</p> <p>默认情况下，系统分析器处于关闭状态，不会进行任何记录。可以在shell中运行<code>db.setProfilingLevel()</code>开启分析器</p> <div class="language-go line-numbers-mode"><pre class="language-go"><code>db<span class="token punctuation">.</span><span class="token function">setProfilingLevel</span><span class="token punctuation">(</span>level<span class="token punctuation">,</span><span class="token operator">&lt;</span>slowms<span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token number">0</span><span class="token operator">=</span>off <span class="token number">1</span><span class="token operator">=</span>slow <span class="token number">2</span><span class="token operator">=</span>all
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>第一个参数是指定级别，不同的级别代表不同的意义，0表示关闭，1表示默认记录耗时大于100毫秒的操作，2表示记录所有操作。第二个参数则是自定义“耗时过长&quot;标准，比如记录所有耗时操作500ms的操作</p> <p>如果开启了分析器而system.profile集合并不存在，MongoDB会为其建立一个大小为若干MB的固定集合(capped collection)。如希望分析器运行更长时间，可能需要更大的空间记录更多的操作。此时可以关闭分析器，删除并重新建立一个新的名为system.profile的固定集合，并令其容量符合要求。然后在数据库上重新启用分析器。</p> <blockquote><p>可以通过db.system.profile.stats()查看集合的最大容量.</p></blockquote> <p>参考：</p> <p><a href="https://juejin.cn/post/6844903907169140750" target="_blank" rel="noopener noreferrer">MongoDB中有几种日志? (juejin.cn)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/gwj12345/interview-learn/edit/master/docs/03.后端/07.MongoDB/2.存储引擎.md" target="_blank" rel="noopener noreferrer">编辑（master改成main）</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/02/06, 19:47:34</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/9fbb16/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">面试问题汇总</div></a> <a href="/pages/eb0774/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">索引</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/9fbb16/" class="prev">面试问题汇总</a></span> <span class="next"><a href="/pages/eb0774/">索引</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2023-2023
    <span>小哈里</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2c633bc6.js" defer></script><script src="/assets/js/2.db71ae02.js" defer></script><script src="/assets/js/84.5096e6ac.js" defer></script>
  </body>
</html>
